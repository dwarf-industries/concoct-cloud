<html>
<head>
    <title>Essential JS 1 : Organizational Chart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8" />
    <link href="../content/bootstrap.min.css" rel="stylesheet" />
    <link href="../content/ejthemes/default-theme/ej.web.all.min.css" rel="stylesheet" />
    <link href="../content/default.css" rel="stylesheet" />
    <link href="../content/default-responsive.css" rel="stylesheet" />
    <script src="../scripts/jquery-3.3.1.min.js" type="text/javascript"></script>
    <script src="../scripts/ej.web.all.min.js"></script>
    <script src="../scripts/properties.js" type="text/javascript"></script>
    <script src="../scripts/jsrender.min.js"></script>
    <script src="../scripts/diagramscripts/diagramcommon.js"></script>
</head>
<body>
    <div class="content-container-fluid">
        <div class="row">
            <div class="cols-sample-area">
                <div id="diagram"></div>
            </div>
            <div id="Propertiespanel">
                <div>
                    <div class="row">
                        <div class="col-md-6">
                            <b>Layout Settings</b>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 aligntop" style="margin-right:-25px;">
                            Orientation
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="align" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 aligntop" style="margin-right:-25px;">
                            Margin X
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="marginX" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 aligntop" style="margin-right:-25px;">
                            Margin Y
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="marginY" />
                        </div>
                    </div>
                    <div class="row"> <div class="col-md-6"></div></div>
                    <div class="row">
                        <div class="col-md-3">
                            <b>Spacing</b>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 aligntop" style="margin-right:-25px;">
                            Horizontal
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="horizontalSpacing" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 aligntop" style="margin-right:-25px;">
                            Vertical
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="verticalSpacing" />
                        </div>
                    </div>
                    <div>
                        <div class="row" id="expandHide">
                            <div class="col-md-3 aligntop" style="margin-right:-25px;">
                                Expand
                            </div>
                            <div class="col-md-3">
                                <input id="expand" />
                            </div>
                        </div>
                        <div class="row" id="orientationHide">
                            <div class="col-md-3 aligntop" style="margin-right:-25px;">
                                Orientation
                            </div>
                            <div class="col-md-3">
                                <input id="orientation" />
                            </div>
                        </div>
                        <div class="row" id="typeAlter">
                            <div class="col-md-3 aligntop" style="margin-right:-25px;">
                                Type
                            </div>
                            <div class="col-md-3">
                                <input id="typeAlternate" />
                            </div>
                        </div>
                        <div class="row" id="typeCenter">
                            <div class="col-md-3 aligntop" style="margin-right:-25px;">
                                Type
                            </div>
                            <div class="col-md-3">
                                <input id="typeCentered" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="list">
                <ul>
                    <li value="toptobottom">Top-Bottom</li>
                    <li value="lefttoright">Left-Right</li>
                    <li value="righttoleft">Right-Left</li>
                    <li value="bottomtotop">Bottom-Top</li>
                </ul>
            </div>
            <div id="horizontalVertical">
                <ul>
                    <li value="horizontal">HORIZONTAL</li>
                    <li value="vertical">VERTICAL</li>

                </ul>
            </div>
            <div id="rightLeftCenter">
                <ul>
                    <li value="right">RIGHT</li>
                    <li value="left">LEFT</li>
                    <li value="center">CENTER</li>
                </ul>
            </div>
            <div id="rightLeftAlternate">
                <ul>
                    <li value="right">RIGHT</li>
                    <li value="left">LEFT</li>
                    <li value="alternate">ALTERNATE</li>
                </ul>
            </div>
        </div>
        <script type="text/javascript">

            //region ej controls

            var addInfo = { orientation: "vertical", type: "alternate" };
            //Initialize data source
            var data = [
                  { "Id": "parent", "Function": "Project Management" },
                  { "Id": "1", "Function": "R&D Team", "Phase": "parent" },
				  { "Id": "2", "Function": "HR Team", "Phase": "parent" },
				  { "Id": "3", "Function": "Sales Team", "Phase": "parent" },
                  { "Id": "4", "Function": "Philosophy", "Phase": "1" },
                  { "Id": "5", "Function": " Organization", "Phase": "1" },
                  { "Id": "6", "Function": "Technology", "Phase": "1" },
                  { "Id": "7", "Function": " Funding", "Phase": "1" },
                  { "Id": "8", "Function": "Resource", "Phase": "1" },
                  { "Id": "9", "Function": "Targeting", "Phase": "1" },
                  { "Id": "10", "Function": "Evaluation", "Phase": "1" },
				  { "Id": "11", "Function": "Recruitment", "Phase": "2" },
				  { "Id": "12", "Function": "Relation", "Phase": "2" },
				  { "Id": "13", "Function": "Design", "Phase": "3" },
				  { "Id": "14", "Function": "Operation", "Phase": "3" },
                  { "Id": "15", "Function": "Support", "Phase": "3" },
				  { "Id": "16", "Function": "Quality", "Phase": "3" },
                  { "Id": "17", "Function": "Interaction", "Phase": "3" },
                  { "Id": "18", "Function": "Support", "Phase": "3" },
                  { "Id": "19", "Function": "Coordination", "Phase": "3" }
            ];

            //Binds Custom JSON with node
            function nodeTemplate(diagram, node) {
                node.labels[0].text = node.Function;
                node.fillColor = node.Color;
                if (node.Id == "parent") { node.fillColor = "#3484bb"; }
                if (node.Phase == "parent") { node.fillColor = "#9ace7f"; }
                if (node.Phase == "1") { node.fillColor = "#9264aa"; }
                if (node.Phase == "2") { node.fillColor = "#9264aa"; }
                if (node.Phase == "3") { node.fillColor = "#9264aa"; }
            }

            //Customize subtree orientation
            function getLayoutInfo(diagram, node, options) {
                if (!options.hasSubTree) {
                    options.orientation = node.addInfo.orientation;
                    options.type = node.addInfo.type;

                }
            }
            $(function () {
                //Initialize Diagram control
                $("#diagram").ejDiagram(
                {
                    height: "450px", width: "100%", tool: ej.datavisualization.Diagram.Tool.SingleSelect | ej.datavisualization.Diagram.Tool.ZoomPan,
                    layout: { type: "organizationalchart", marginX: 3, marginY: 3, getLayoutInfo: getLayoutInfo },
                    defaultSettings: {
                        node: { constraints: ej.datavisualization.Diagram.NodeConstraints.Select | ej.datavisualization.Diagram.NodeConstraints.PointerEvents, addInfo: addInfo, width: 100, height: 40, borderColor: "black", labels: [{ fontColor: "#ffffff" }] },
                        connector: {
                            lineColor: "#000000", segments: [{ type: "orthogonal" }], targetDecorator: { shape: "none" },
                            constraints: ej.datavisualization.Diagram.ConnectorConstraints.None
                        }
                    },
                    selectedItems: { constraints: ~ej.datavisualization.Diagram.SelectorConstraints.Rotator },
                    selectionChange: "selectionChanged",
                    nodeTemplate: "nodeTemplate",
                    dataSourceSettings: {
                        id: "Id", parent: "Phase", dataSource: data
                    },
                    pageSettings: {
                        scrollLimit: "diagram", muliplePages: false
                    },
                    snapSettings: {
                        snapConstraints: ej.datavisualization.Diagram.SnapConstraints.None
                    },
                    click: "diagramClick"

                });
                diagramFitToPage("diagram");
                //Initialize property panel
                $("#Propertiespanel").ejPropertiesPanel();

                //Drop down list - orientation
                $("#align").ejDropDownList({
                    text: "Top-Bottom", value: "toptobottom", targetID: "list", width: "130px",
                    change: function (args) {
                        $("#diagram").ejDiagram({
                            layout: {
                                orientation: args.value,
                            }
                        });
                    }
                });

                //Numeric text boxes - for margin and spacings
                $("#horizontalSpacing").ejNumericTextbox({
                    value: 30, minValue: 0, maxValue: 1000, width: "130px",
                    change: function (args) {
                        $("#diagram").ejDiagram({ layout: { horizontalSpacing: args.value } });
                    }
                });
                $("#verticalSpacing").ejNumericTextbox({
                    value: 30, minValue: 0, maxValue: 1000, width: "130px",
                    change: function (args) {
                        $("#diagram").ejDiagram({ layout: { verticalSpacing: args.value } });
                    }
                });
                $("#marginX").ejNumericTextbox({
                    value: 3, minValue: -120, maxValue: 1000, width: "130px",
                    change: function (args) {
                        $("#diagram").ejDiagram({ layout: { marginX: args.value } });
                    }
                });
                $("#marginY").ejNumericTextbox({
                    value: 3, minValue: 0, maxValue: 1000, width: "130px",
                    change: function (args) {
                        $("#diagram").ejDiagram({ layout: { marginY: args.value } });
                    }
                });

                //Ej check box to expand or collapse nodes
                $("#expand").ejCheckBox({
                    change: function (args) {
                        var diagram = $("#diagram").ejDiagram("instance");
                        if (diagram.model.selectedItems.children.length != 0)
                            diagram.updateNode(diagram.model.selectedItems.children[0].name, { isExpanded: args.isChecked ? true : false })
                    }
                });

                //Drop down list to change subtree orientation
                $("#orientation").ejDropDownList({
                    text: "VERTICAL", value: "Vertical", targetID: "horizontalVertical", width: "130px",
                    change: function (args) {
                        updateSubTreeOrientation({ orientation: args.value });
                        if (args.value == "horizontal") {
                            $("#typeCenter").show();
                            $("#typeAlter").hide();
                        }
                        else if (args.value == "vertical") {
                            $("#typeCenter").hide();
                            $("#typeAlter").show();
                        }
                    }
                });

                //Drop down to change the vertical subtree orientation
                $("#typeAlternate").ejDropDownList({
                    watermarkText: "Type", targetID: "rightLeftAlternate", text: "ALTERNATE", value: "alternate", width: "130px",
                    change: function (args) {
                        updateSubTreeOrientation({ type: args.value });
                    }
                });

                //Drop down to change the horizontal subtree orientation
                $("#typeCentered").ejDropDownList({
                    watermarkText: "Type", text: "CENTER", value: "center", width: "130px", targetID: "rightLeftCenter",
                    change: function (args) {
                        updateSubTreeOrientation({ type: args.value });
                    }
                });

            });
            //end region

            //region event handlers

            //Selection change event
            function selectionChanged(args) {
			if(args.state==="changing"){
                var node, expanded;
                if (args.selectedItems.length == 1 && args.selectedItems[0].type == "basic") {
                    node = args.selectedItems[0];
                    expanded = node.isExpanded;
                    hideSubTreeOptions(node.outEdges.length);
                    $("#expand").ejCheckBox({ checked: expanded ? true : false });
                    $("#orientation").ejDropDownList({ checked: expanded ? true : false });
                    $("#typeAlternate").ejDropDownList({ checked: expanded ? true : false });
                    $("#typeCentered").ejDropDownList({ checked: expanded ? true : false });
                    if (node.addInfo.orientation) {
                        $("#orientation").ejDropDownList({ value: node.addInfo.orientation });
                    }
                    if (node.addInfo.type) {
                        if (node.addInfo.type !== "center")
                            $("#typeAlternate").ejDropDownList({ value: node.addInfo.type });
                        if (node.addInfo.type !== "alternate")
                            $("#typeCentered").ejDropDownList({ value: node.addInfo.type });
                    }
                }
                else {
                    hideSubTreeOptions();
                }
			}
           }

            function diagramClick(args) {
                if (!args.element || args.element.type != "basic") {
                    var diagram = $("#diagram").ejDiagram("instance");
                    diagram.clearSelection();
                }
            }

            $(window).on("load", function () {
                //Hide all dropdowns on loading
                hideSubTreeOptions();
            });

            //endregion

            //region helper methods

            function updateSubTreeOrientation(options) {
                var diagram = $("#diagram").ejDiagram("instance");
                if (diagram.model.selectedItems.children[0]) {
                    var selectedNode = diagram.model.selectedItems.children[0];
                    if (options.type) { selectedNode.addInfo.type = options.type; }
                    if (options.orientation) { selectedNode.addInfo.orientation = options.orientation; }
                    diagram.model.layout.fixedNode = selectedNode.name;
                    diagram.layout();
                    diagram.addSelection(selectedNode);
					diagram.model.layout.fixedNode = null;
                }
            }

            function hideSubTreeOptions(show) {
                if (show) {
                    $("#expandHide").show();
                    $("#orientationHide").show();
                    $("#typeAlter").show();
                }
                else {
                    $("#expandHide").hide();
                    $("#orientationHide").hide();
                    $("#typeAlter").hide();
                    $("#typeCenter").hide();
                }
            }

            //endregion
        </script>
        <style>
            #resizeBorder {
                stroke: black;
                stroke-width: 3px;
                stroke-dasharray: none;
                opacity: 1;
            }

            #nw-resize, #n-resize, #ne-resize, #w-resize, #e-resize, #sw-resize, #s-resize, #se-resize {
                fill: none;
                stroke: transparent;
            }
        </style>
</body>
</html>
